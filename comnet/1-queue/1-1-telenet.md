---
layout: post
title: 电话网排队模型
---

第一部分是排队论。这里，我们可以把网络的延迟比作去食堂排队时，我们需要等多久才能吃到饭。简单来说，就是“平均延迟”的概念。通过这样的实验，我们可以建立一个网络的排队系统模型。

## 排队模型

当我们排队时，实际上我们可以给排队过程建立一个数学模型，这个模型在各种情况下都有不同的表现。比如说，常见的排队模型有M/M模型（即到达和服务时间都服从负指数分布）。这里的“到达”代表的是数据包的到来，而“服务时间”则表示数据包处理的时间。如果服务时间服从负指数分布，那么这就可以描述为一个马尔可夫过程。

大家应该听说过马尔可夫吧？马尔可夫是一位著名的数学家，研究了与此相关的模型。M/M模型中的“M/M”表示：一个是“到达过程”（例如数据包到达的速度），另一个是“服务过程”（即数据包处理的速度）。服务时间是无记忆的，也就是说，每次服务的时间和前一次服务没有关系。如果只有一个服务台（一个队列），所有请求都排队等待，这个模型就称为“M/M1模型”。我们通常称这种排队方式为“M/M/1”。

## 电话网排队模型

为什么我们学习排队论这个概念呢？因为我们学的是通信工程，很多通信过程本质上也是一个排队问题。例如，在电话网络中，通话的信号会通过中继线传输。假设有32个传输通道，其中30个是用来传输语音数据，另外2个是保留的。在这种情况下，如果这30个通道都被占用了，那么新的通话请求就会被“阻塞”，也就是无法连接。

我们用M/M/m/m模型来描述电话网的阻塞概率。它后面的两个m/m表示的是有多条中继线。我们可以把中继线比作服务员，也就是系统中的资源。这个模型可以帮助我们理解在某些情况下，电话系统会因为资源不足而无法接通电话的现象。

这个模型背后的数学基础是由一位叫做“爱尔兰”的数学家提出的。他并不是指爱尔兰这个国家，而是他自己名字的一部分。他建立了这个模型并且提出了相关的公式，用来分析排队系统中的阻塞概率。

他提出的公式被称为“爱尔兰B公式”，其中的“B”代表“Block”，即阻塞。该公式的意思是：假设我们有M个服务员，当你到达时，必须有一个空闲的服务员来接待你。如果所有的服务员都在忙，那么你就会被“阻塞”，即无法得到服务。爱尔兰B公式就是用来计算这种情况下的阻塞概率。

## 电话网配置难题

假设你们以后加入中国电信或中国联通工作时，可能会遇到这样的情况：

某个小区刚刚建立起来，里面有1000户人家。这1000个家庭每天都有电话需求，但并不是每个家庭都每天打电话，也不是所有人都会在同一时段打电话。因此，电话的到达是随机的，可以看作是一个泊松过程，即电话到达的时间是随机的，不确定的。

此外，我们假设每个用户的通话时长也是随机的，且服从负指数分布。负指数分布意味着每个用户的通话时间是随机的，但有的人打电话比较长，而有的人打电话比较短。负指数分布的特点是无记忆性，即当前的通话时长不会影响未来的通话时长。

因此，我们的目标是要分析，在这种随机到达和随机通话时长的情况下，如何决定我们需要配置多少条实际的电话线路来满足1000户人家的电话需求。

假设这1000个家庭每天每人平均打0.3个电话。这个数值是平均值，并不是每个人每天都打0.3次电话，而是统计出来的整体平均数。也就是说，1000个家庭一天打电话的平均次数是：$$ 1000 \times 0.3 = 300 $$

这就意味着，在某一天，整个小区一共可能会有300个电话请求。然而，由于这些电话请求是随机到达的，是不可预测的，也就是说，并不是每个家庭每天都会打电话。

注意每天300个电话是一个平均值，但每天的电话数会有所波动。有些天可能只有200个电话，而有些天可能会有400个电话。因此，我们需要根据这个平均值来决定话路的配置。

为了处理这些电话请求，我们需要一个合适的话路数，即能同时接入电话的线路数量。如果我们配置的线路数过少，就可能出现电话占线的情况，导致无法接通更多的电话。而如果配置的线路过多，又会浪费资源，因此如何平衡这些需求是我们面临的挑战。

通过这样的分析，我们可以更好地理解如何根据电话到达的随机性和通话时长的随机性来合理配置电话网的资源。这种分析方法不仅在电话网络中有应用，在其他通信网络的资源配置中同样适用。

## 电话网传输原理

语音信号首先会通过采样和 PCM 编码，变为数字。

PCM 是将模拟信号转换为数字信号的技术。大家应该记得 PCM 编码的过程吧。比如说，采样频率为 8kHz，意味着每秒钟采样 8000 个样本。每个样本又用 8 个比特来编码。那么每秒钟需要传输多少数据呢？答案是：8kHz 的采样频率，每个样本 8 个比特，总共就是 64kbps（千比特每秒）。

假设陈老师现在正在说话，声音信号经过 PCM 编码后，我们就可以将其数字化，并通过电话或其他数字通信方式传输到对方耳朵里。每秒钟，我们需要传输 64KB 的数据。这就是 PCM 传输的基本原理。

在电话网传输中，会通过时分复用进行多路语音同时传输。

那么，我们的语音具体是怎么传输的呢？在 PCM 系统中，每隔 125 微秒，我们就会传输一个 8 比特的数据包。这意味着每秒钟，我们传输 8000 个样本，每个样本 8 个比特。

在通信网络中，多个用户的语音信号需要通过同一条线路进行传输。为此，我们采用了时间复用技术（TDM），将每个用户的数据按照时间片段进行分配。比如说，假设我们有30个用户，每个用户的语音信号需要传输64kbps，那么总的带宽需求就是30 × 64kbps = 1920kbps。

通过TDM技术，我们将这30个用户的语音数据按时间顺序发送，每个用户在不同的时间片段内传输他们的语音数据。这样就能实现多个用户共享一条线路而不会相互干扰。

每个用户的语音数据都在自己的时间片段内进行传输，通过时间复用技术，每个用户的数据都能顺利地被传送到目标设备。

这就是电话交换网的语音信号传输方式：通过高效的时间分复用技术，我们能够在同一条传输线路上同时处理多个信号。实际上，电话通信系统就是通过这种方式实现多用户共享一条传输链路的。

PCM 一次群，就是这样一个结构。它的带宽是 2.048 兆比特，包括32个话路（也叫信道）。其中有一部分用于系统控制，不能用于实际传输。比如，系统保留了 2 个信道用于管理和控制，因此实际可用的信道为 1 到 15 和 17 到 31，共 30 个信道。因此，它就可以同时容纳 30路电话进行通信。

## 阻塞率分析

假设我们现在有1000个电话用户，每天每个用户平均打0.3个电话，打电话的时长是随机的。现在的问题是：如何决定每个小区需要配置多少根话路（即中继线）来满足这些用户的需求？如果话路被占用了，后续打过来的的电话就会被阻塞。

假设你现在是中国电信的工作人员，你被要求为这个小区配置话路。你知道，每天300个电话可能并不会全部集中在同一时刻，所以并不需要每天都有足够的资源来承载这些电话。假设每个电话的平均时长是3分钟，那么300个电话大约需要900分钟。

但由于电话的到达是随机的，大家并不总是同时打电话。所以，即便电话的总时长是900分钟，但每条话路并不一定会被同时占用。因此，问题的关键是：你需要多少条话路？

假设目前只有4条话路。如果某个用户打电话，所有话路都被占用，那么其他用户打电话时就会出现阻塞，无法接通。这种情况就是阻塞，也叫“中断”或“堵塞”，就像下水道堵塞一样。

用户遇到电话无法接通的情况是非常不开心的，这时他们可能会抱怨。因此，作为通信网络的设计者，你必须确保不会出现过多的阻塞情况。如何做到这一点呢？

我们可以通过爱尔兰B公式来计算阻塞率。假设我们计算出，当配置4条话路时，系统的阻塞率为1%。这意味着，1%的用户呼叫会遇到无法接通的情况。如果中国电信的经理认为1%的阻塞率过高，就要求你调整配置，将阻塞率降低。

为了将阻塞率从1%降低到0.1%，你需要配置更多的中继线。这时，我们需要通过计算得出，为了将阻塞率降到0.1%，需要将话路数增加到多少。也就是说，话路数与阻塞率是密切相关的，更多的话路可以降低阻塞的概率。

通过这种方式，你可以根据需求配置合适数量的话路，避免过高的阻塞率影响用户体验。

## 总结

这就是我们在通信网络中进行话路配置时需要考虑的因素。我们需要根据电话的到达率、通话时长以及期望的阻塞率来合理配置中继线的数量。使用数学公式（如爱尔兰B公式），我们可以量化阻塞率，并在此基础上进行优化，确保每个小区的通信需求得到满足。

这也是通信工程师们在设计网络时要面对的实际问题——如何在有限的资源下，合理配置话路，以保证网络的高效运行。

## 排队论

排队论（Queueing Theory）是研究排队系统的数学理论，常用于分析和优化通信网络中的数据流、客户服务系统等。

大家感觉到了吗？在我们学习这部分时，许多内容都涉及到了随机过程、概率论和阻塞概率。这些知识其实都与我们学过的概率论有很大关系，像是泊松过程、负指数分布等。这些概念都是随机过程的一部分，是我们通信系统中不可或缺的基础。

在这里，我们所讨论的模型被称为“马尔可夫模型”。马尔可夫模型非常有用，它不仅仅应用于通信领域，还广泛应用于其他学科。例如，在运筹学、计算机科学甚至语音识别中，我们都能看到它的身影。通过马尔可夫模型，我们可以将现实世界中的许多随机过程转化为数学模型，从而进行更有效的分析和计算。

因此，马尔可夫模型是一个基本的概念，大家需要深刻理解和体会。这也是第一部分内容的核心。希望通过学习，大家能够掌握这些基本的概率论知识，并能运用它们解决实际问题。

## 扩展阅读：华为

程控交换机是一种通过程序来控制电话交换过程的设备，它的出现彻底改变了电话交换的方式，使得电话通信更加高效和自动化。在程控交换机之前，电话交换是通过人工操作来完成的，但随着技术的进步，程控交换机的出现大大提高了通信网络的效率和灵活性。

华为的起家就是从做程控交换机开始的。任正非当年从部队退役后，进入了通信领域，最初的创业项目就是代理和生产程控交换机。在那个时代，电话交换机基本上都是进口的，价格高昂。举个例子，普通的家庭电话安装费用高达1000多块钱，而那个时候的月工资才100多块钱。因此，家里有电话机是身份和地位的象征。

任正非看到了这个市场需求，并决定自己动手研发程控交换机。虽然他并不是一个完全的硬件工程师，但他学过编程，具备开发程控交换机的能力。于是，他和几位朋友一起开始了华为的程控交换机项目。华为通过研发自己生产的交换机，不仅能够大幅降低成本，还能提供比进口交换机便宜的价格，这使得华为在市场上取得了巨大的成功。

程控交换机的基本原理是：你拨打一个电话时，交换机会接收你输入的号码，并通过程序将其转换为数字信号，然后将信号传送到目标电话。而且，程控交换机的优势在于它的自动化和高效性，它替代了过去需要人工操作的方式，极大提高了电话交换的效率。

除了华为，其他公司如巨大中华、大唐等，也曾是程控交换机的主要制造商。如今，这些公司已经或消失或转型，但它们的技术曾经为通信行业的发展做出了巨大贡献。

这个故事也展现了一个创业的典范：通过敏锐的市场洞察和技术创新，华为从一个小小的交换机制造商成长为全球领先的通信设备提供商。

## 参考文献

- 任正非：华为研发交换机产品的知识源自于南邮！2020-07-23，[网页链接](https://www.sohu.com/a/409331610_349987)

<br/>

|[Index](./) | [Previous](.) | [Next](1-2-comnet)|
